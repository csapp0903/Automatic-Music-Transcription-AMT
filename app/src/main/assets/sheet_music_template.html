<!DOCTYPE html>
<html>
<head>
    <title>Sheet Music</title>
    <script src="https://cdn.jsdelivr.net/npm/vexflow@4.2.2/build/cjs/vexflow.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #output { display: inline-block; }
    </style>
</head>
<body>
    <h2>Generated Sheet Music</h2>
    <div id="output"></div>

    <script>
        const { Factory, EasyScore, System } = Vex.Flow;

        function renderScore(scoreData) {
            // scoreData 是从 Android 传来的 JSON 对象
            // 格式: { notes: [{pitch: 60, duration: 1.0, ...}], tempo: 120 }
            
            const vf = new Factory({
                renderer: { elementId: 'output', width: 800, height: 1000 }
            });

            const score = vf.EasyScore();
            const system = vf.System();

            // 将 MIDI 音符转换为 VexFlow 格式 (例如 60 -> "C4/q")
            // 这里做一个简化的映射逻辑
            let vfNotes = [];
            
            // 简单演示：只取前 16 个音符，每 4 个音符一个小节
            // 实际生产环境需要复杂的算法来计算小节线和时值
            let currentVoice = [];
            
            scoreData.notes.forEach((note, index) => {
                const noteName = midiToNoteName(note.pitch);
                // 简化：全部视为四分音符
                currentVoice.push(noteName + "/q");
                
                if (currentVoice.length === 4) {
                    system.addStave({
                        voices: [score.voice(score.notes(currentVoice.join(", ")))]
                    }).addClef('treble');
                    
                    currentVoice = [];
                }
            });

            // 处理剩余音符
            if (currentVoice.length > 0) {
                 system.addStave({
                    voices: [score.voice(score.notes(currentVoice.join(", ")))]
                }).addClef('treble');
            }

            vf.draw();
        }

        function midiToNoteName(midi) {
            const notes = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
            const octave = Math.floor(midi / 12) - 1;
            const name = notes[midi % 12];
            return name + octave; // e.g., "C4"
        }
    </script>
</body>
</html>